<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>SPCG | Perfil</title>

  <script src="./js/sessao.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="stylesheet" href="./css/estilo.css">
  <link rel="icon" href="assets/imgs/SPCG.png" type="image/png">
  <link rel="preconnect" href="https://fonts.gstatic.com">
</head>

<body onload="buscarInformacoes(), dashboardsAcertosErros()">

  <div id="pagina">

    <!-- HEADER  -->
    <div class="header">
      <div class="container">
        <img src="assets/imgs/SPCG.png" alt="" width="250px">
        <ul class="navbar">
          <li class="agora">
            <a href="index.html">Inicial</a>
          </li>
          <li>
            <a href="jogos.html">Jogos</a>
          </li>
          <li>
            <a href="simulador.html">Simulador</a>
          </li>
          <li>
            <a href="#" onclick="Exibir()"><img src="assets/imgs/hamburguer-icone.png"
                style="display: block; width: 50px;" alt=""></a>
          </li>
        </ul>
      </div>

      <div id="div_escondida" style="display: none;">
        <div class="janela">
          <div class="header-left">

            <div class="hello">
              <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
            </div>

            <div class="btn-nav-white" style="display: block;" id="div_cadastro">
              <a href="cadastro.html">
                <h3>Cadastrar</h3>
              </a>
            </div>

            <div class="btn-nav-white" style="display: block;" id="div_login">
              <a href="login.html">
                <h3>Login</h3>
            </div>

            <div class="btn-nav-white" style="display: none;" id="div_perfil">
              <a href="perfil.html">
                <h3>Perfil</h3>
            </div>

            <div class="btn-nav-white">
              <a href="allPerfil.html">
                <h3>Todos os Perfis</h3>
              </a>
            </div>

            <div class="btn-logout" onclick="limparSessao()">
              <h3>Sair</h3>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- HEADER  -->

    <div class="simulador">
      <div class="perfil_container">
        <div>
          <h2>Perfil</h2>
          <p>Nome: <br><span id="nome"></span></p>
          <p>Username: <br><span id="username"></span></p>
          <p>Categoria de jogos favorita: <br><span id="categoria"></span></p>
          <div>
            <p>Melhores pontuações:<br><span id="historico_partidas">Não há histórico de jogos no momento.</span></p>
            <div style="width: 100%; height: 100%; margin: auto;">
              <canvas id="donut"></canvas>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="footer">
      <div class="container">
        <h4>Feito por Guilherme Santos Dias 1CCOA</h4>
        <span class="version">v1.0.0</span>
      </div>
    </div>
  </div>

</body>

</html>
<script>
  let acertos = 0;
  let erros = 0;
  let tentativas = 0;

  function buscarInformacoes() {
    nome.innerHTML = sessionStorage.NOME_USUARIO;
    username.innerHTML = sessionStorage.USERNAME_USUARIO;
    categoria.innerHTML = sessionStorage.CATEGORIA_USUARIO;
    if (sessionStorage.HISTORICO_USUARIO != undefined) {
      historico_partidas.innerHTML = `Não há histórico para recarregar no momento.`;
    }
  }

  function dashboardsAcertosErros() {
    let idPerfil = sessionStorage.ID_USUARIO;

    console.log(idPerfil);

    fetch(`/medidas/buscarResultados/${idPerfil}`, {
      method: "GET",
    })
      .then(function (resposta) {
        resposta.json().then((conta) => {
          conta.forEach((acertosErros) => {
            acertos += acertosErros.certo;
            erros += acertosErros.errado;

            tentativas += acertosErros.certo;
            tentativas += acertosErros.errado;
          });
          gerarDashboard();
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function gerarDashboard() {
    if(tentativas > 0){
      historico_partidas.innerHTML = ``;
      
      const ctxDonut = document.getElementById('donut').getContext('2d');

    let myChart = new Chart(ctxDonut, {
      type: 'doughnut',
      data: {
        labels: ['Acertos', 'Erros'],
        datasets: [{
          data: [(acertos/tentativas *100), (erros/tentativas *100)],
          backgroundColor: ['green', 'red'],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom'
          },
          title: {
            display: true,
            text: 'Quizz Resultados: (%)',
          }
        }
      }
    });
  }
}
</script>
<script src="js/redirecionamento.js"></script>